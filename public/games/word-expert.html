<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å•è¯å°ä¸“å®¶ - HomeStroy æ¸¸æˆå¤§å…</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
      min-height: 100vh;
      color: white;
    }

    .game-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .game-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .game-title {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }

    .stat-item {
      background: rgba(255,255,255,0.2);
      padding: 10px 25px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.8;
    }

    .stat-value {
      font-size: 28px;
      font-weight: bold;
    }

    .game-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
    }

    .word-display {
      font-size: 72px;
      margin-bottom: 15px;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .phonetic {
      font-size: 24px;
      opacity: 0.8;
      margin-bottom: 30px;
    }

    .options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      max-width: 600px;
      width: 100%;
    }

    .option-btn {
      padding: 20px 30px;
      font-size: 20px;
      background: white;
      color: #333;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .option-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .option-btn.correct {
      background: #27ae60;
      color: white;
    }

    .option-btn.wrong {
      background: #e74c3c;
      color: white;
    }

    .timer-bar {
      width: 100%;
      max-width: 600px;
      height: 10px;
      background: rgba(255,255,255,0.3);
      border-radius: 5px;
      margin-top: 30px;
      overflow: hidden;
    }

    .timer-fill {
      height: 100%;
      background: white;
      transition: width 0.1s linear;
    }

    .start-screen, .game-over-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    .start-screen.hidden, .game-over-screen.hidden {
      display: none;
    }

    .start-screen h1 {
      font-size: 72px;
      margin-bottom: 20px;
      text-shadow: 0 0 30px #3498db;
    }

    .start-screen p {
      font-size: 20px;
      margin-bottom: 30px;
      opacity: 0.8;
      max-width: 600px;
      text-align: center;
      line-height: 1.6;
    }

    .level-selector {
      margin-bottom: 30px;
    }

    .level-selector label {
      display: block;
      margin-bottom: 15px;
      font-size: 18px;
      cursor: pointer;
    }

    .level-selector input[type="radio"] {
      margin-right: 10px;
      width: 20px;
      height: 20px;
    }

    .start-btn, .restart-btn {
      padding: 20px 60px;
      font-size: 24px;
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      font-weight: bold;
    }

    .start-btn:hover, .restart-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(52, 152, 219, 0.5);
    }

    .game-over-screen h1 {
      font-size: 64px;
      margin-bottom: 30px;
      color: #3498db;
    }

    .final-stats {
      text-align: center;
      margin-bottom: 30px;
    }

    .final-stats p {
      font-size: 20px;
      margin: 10px 0;
    }

    .final-stats .final-score {
      font-size: 72px;
      color: #3498db;
      margin: 20px 0;
    }

    .high-scores {
      display: flex;
      gap: 30px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .high-score-item {
      text-align: center;
      background: rgba(255,255,255,0.1);
      padding: 15px 25px;
      border-radius: 10px;
    }

    .high-score-label {
      font-size: 14px;
      opacity: 0.7;
    }

    .high-score-value {
      font-size: 28px;
      font-weight: bold;
      color: #f1c40f;
    }

    .streak-display {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.7);
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 18px;
    }

    .streak-display.hot {
      background: linear-gradient(135deg, #f39c12, #e74c3c);
      animation: pulse 0.5s infinite alternate;
    }

    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }

    .progress-info {
      font-size: 16px;
      opacity: 0.8;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="game-header">
      <div class="game-title">ğŸ“– å•è¯å°ä¸“å®¶</div>
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">åˆ†æ•°</div>
          <div class="stat-value" id="score">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">æ­£ç¡®</div>
          <div class="stat-value" id="correct">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">é”™è¯¯</div>
          <div class="stat-value" id="wrong">0</div>
        </div>
      </div>
    </div>

    <div class="streak-display" id="streakDisplay">
      ğŸ”¥ è¿å‡»: <span id="streak">0</span>
    </div>

    <div class="game-area">
      <div class="progress-info" id="progressInfo">é¢˜ç›® 1/20</div>
      <div class="word-display" id="wordDisplay">word</div>
      <div class="phonetic" id="phonetic">/wÉœËrd/</div>
      <div class="options" id="options"></div>
      <div class="timer-bar">
        <div class="timer-fill" id="timerFill"></div>
      </div>
    </div>

    <div class="start-screen" id="startScreen">
      <h1>ğŸ“– å•è¯å°ä¸“å®¶</h1>
      <p>
        æµ‹è¯•ä½ çš„è‹±è¯­è¯æ±‡é‡ï¼<br>
        æ ¹æ®æ˜¾ç¤ºçš„è‹±æ–‡å•è¯ï¼Œé€‰æ‹©æ­£ç¡®çš„ä¸­æ–‡å«ä¹‰ã€‚<br>
        å›ç­”è¶Šå¿«ï¼Œå¾—åˆ†è¶Šé«˜ï¼è¿ç»­ç­”å¯¹å¯è·å¾—è¿å‡»åŠ åˆ†ï¼
      </p>
      <div class="level-selector">
        <label>
          <input type="radio" name="level" value="easy" checked>
          åˆçº§ - å¸¸ç”¨ç®€å•è¯æ±‡
        </label>
        <label>
          <input type="radio" name="level" value="medium">
          ä¸­çº§ - æ—¥å¸¸è¯æ±‡
        </label>
        <label>
          <input type="radio" name="level" value="hard">
          é«˜çº§ - è¿›é˜¶è¯æ±‡
        </label>
      </div>
      <button class="start-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div class="game-over-screen hidden" id="gameOverScreen">
      <h1>ğŸ“ æ¸¸æˆç»“æŸ</h1>
      <div class="final-stats">
        <p>æœ€ç»ˆåˆ†æ•°</p>
        <div class="final-score" id="finalScore">0</div>
        <p>æ­£ç¡®: <span id="finalCorrect">0</span> | é”™è¯¯: <span id="finalWrong">0</span></p>
        <p>æ­£ç¡®ç‡: <span id="accuracy">0</span>%</p>
        <p>æœ€é«˜è¿å‡»: <span id="maxStreak">0</span></p>
      </div>
      <div class="high-scores">
        <div class="high-score-item">
          <div class="high-score-label">ä»Šæ—¥æœ€é«˜</div>
          <div class="high-score-value" id="dailyBest">0</div>
        </div>
        <div class="high-score-item">
          <div class="high-score-label">æœ¬å‘¨æœ€é«˜</div>
          <div class="high-score-value" id="weeklyBest">0</div>
        </div>
        <div class="high-score-item">
          <div class="high-score-label">å†å²æœ€é«˜</div>
          <div class="high-score-value" id="allTimeBest">0</div>
        </div>
      </div>
      <button class="restart-btn" onclick="restartGame()">å†æ¥ä¸€å±€</button>
    </div>
  </div>

  <script>
    const GAME_ID = 'word-expert';
    
    const wordDatabase = {
      easy: [
        { word: 'apple', phonetic: '/ËˆÃ¦pl/', meaning: 'è‹¹æœ' },
        { word: 'book', phonetic: '/bÊŠk/', meaning: 'ä¹¦' },
        { word: 'cat', phonetic: '/kÃ¦t/', meaning: 'çŒ«' },
        { word: 'dog', phonetic: '/dÉ’É¡/', meaning: 'ç‹—' },
        { word: 'egg', phonetic: '/eÉ¡/', meaning: 'é¸¡è›‹' },
        { word: 'fish', phonetic: '/fÉªÊƒ/', meaning: 'é±¼' },
        { word: 'girl', phonetic: '/É¡ÉœËrl/', meaning: 'å¥³å­©' },
        { word: 'happy', phonetic: '/ËˆhÃ¦pi/', meaning: 'å¿«ä¹çš„' },
        { word: 'ice', phonetic: '/aÉªs/', meaning: 'å†°' },
        { word: 'jump', phonetic: '/dÊ’ÊŒmp/', meaning: 'è·³' },
        { word: 'king', phonetic: '/kÉªÅ‹/', meaning: 'å›½ç‹' },
        { word: 'love', phonetic: '/lÊŒv/', meaning: 'çˆ±' },
        { word: 'moon', phonetic: '/muËn/', meaning: 'æœˆäº®' },
        { word: 'name', phonetic: '/neÉªm/', meaning: 'åå­—' },
        { word: 'open', phonetic: '/ËˆoÊŠpÉ™n/', meaning: 'æ‰“å¼€' },
        { word: 'play', phonetic: '/pleÉª/', meaning: 'ç©' },
        { word: 'queen', phonetic: '/kwiËn/', meaning: 'å¥³ç‹' },
        { word: 'run', phonetic: '/rÊŒn/', meaning: 'è·‘' },
        { word: 'sun', phonetic: '/sÊŒn/', meaning: 'å¤ªé˜³' },
        { word: 'tree', phonetic: '/triË/', meaning: 'æ ‘' },
        { word: 'water', phonetic: '/ËˆwÉ”ËtÉ™r/', meaning: 'æ°´' },
        { word: 'yellow', phonetic: '/ËˆjeloÊŠ/', meaning: 'é»„è‰²çš„' },
        { word: 'zoo', phonetic: '/zuË/', meaning: 'åŠ¨ç‰©å›­' },
        { word: 'bird', phonetic: '/bÉœËrd/', meaning: 'é¸Ÿ' },
        { word: 'flower', phonetic: '/ËˆflaÊŠÉ™r/', meaning: 'èŠ±' }
      ],
      medium: [
        { word: 'adventure', phonetic: '/É™dËˆventÊƒÉ™r/', meaning: 'å†’é™©' },
        { word: 'beautiful', phonetic: '/ËˆbjuËtÉªfl/', meaning: 'ç¾ä¸½çš„' },
        { word: 'celebrate', phonetic: '/ËˆselÉªbreÉªt/', meaning: 'åº†ç¥' },
        { word: 'discover', phonetic: '/dÉªËˆskÊŒvÉ™r/', meaning: 'å‘ç°' },
        { word: 'excellent', phonetic: '/ËˆeksÉ™lÉ™nt/', meaning: 'æå¥½çš„' },
        { word: 'familiar', phonetic: '/fÉ™ËˆmÉªliÉ™r/', meaning: 'ç†Ÿæ‚‰çš„' },
        { word: 'generous', phonetic: '/ËˆdÊ’enÉ™rÉ™s/', meaning: 'æ…·æ…¨çš„' },
        { word: 'horizon', phonetic: '/hÉ™ËˆraÉªzn/', meaning: 'åœ°å¹³çº¿' },
        { word: 'imagine', phonetic: '/ÉªËˆmÃ¦dÊ’Éªn/', meaning: 'æƒ³è±¡' },
        { word: 'journey', phonetic: '/ËˆdÊ’ÉœËrni/', meaning: 'æ—…ç¨‹' },
        { word: 'knowledge', phonetic: '/ËˆnÉ’lÉªdÊ’/', meaning: 'çŸ¥è¯†' },
        { word: 'language', phonetic: '/ËˆlÃ¦Å‹É¡wÉªdÊ’/', meaning: 'è¯­è¨€' },
        { word: 'mountain', phonetic: '/ËˆmaÊŠntÉ™n/', meaning: 'å±±' },
        { word: 'neighbor', phonetic: '/ËˆneÉªbÉ™r/', meaning: 'é‚»å±…' },
        { word: 'opportunity', phonetic: '/ËŒÉ’pÉ™rËˆtuËnÉ™ti/', meaning: 'æœºä¼š' },
        { word: 'patience', phonetic: '/ËˆpeÉªÊƒns/', meaning: 'è€å¿ƒ' },
        { word: 'quality', phonetic: '/ËˆkwÉ’lÉ™ti/', meaning: 'è´¨é‡' },
        { word: 'remember', phonetic: '/rÉªËˆmembÉ™r/', meaning: 'è®°ä½' },
        { word: 'success', phonetic: '/sÉ™kËˆses/', meaning: 'æˆåŠŸ' },
        { word: 'treasure', phonetic: '/ËˆtreÊ’É™r/', meaning: 'å®è—' },
        { word: 'universe', phonetic: '/ËˆjuËnÉªvÉœËrs/', meaning: 'å®‡å®™' },
        { word: 'volunteer', phonetic: '/ËŒvÉ’lÉ™nËˆtÉªÉ™r/', meaning: 'å¿—æ„¿è€…' },
        { word: 'wonderful', phonetic: '/ËˆwÊŒndÉ™rfl/', meaning: 'ç²¾å½©çš„' },
        { word: 'yesterday', phonetic: '/ËˆjestÉ™rdeÉª/', meaning: 'æ˜¨å¤©' },
        { word: 'adventure', phonetic: '/É™dËˆventÊƒÉ™r/', meaning: 'å†’é™©' }
      ],
      hard: [
        { word: 'accomplish', phonetic: '/É™ËˆkÉ’mplÉªÊƒ/', meaning: 'å®Œæˆ' },
        { word: 'benevolent', phonetic: '/bÉ™ËˆnevÉ™lÉ™nt/', meaning: 'ä»æ…ˆçš„' },
        { word: 'comprehensive', phonetic: '/ËŒkÉ’mprÉªËˆhensÉªv/', meaning: 'å…¨é¢çš„' },
        { word: 'deteriorate', phonetic: '/dÉªËˆtÉªÉ™riÉ™reÉªt/', meaning: 'æ¶åŒ–' },
        { word: 'enthusiasm', phonetic: '/ÉªnËˆÎ¸juËziÃ¦zÉ™m/', meaning: 'çƒ­æƒ…' },
        { word: 'fundamental', phonetic: '/ËŒfÊŒndÉ™Ëˆmentl/', meaning: 'åŸºæœ¬çš„' },
        { word: 'gratitude', phonetic: '/ËˆÉ¡rÃ¦tÉªtjuËd/', meaning: 'æ„Ÿæ¿€' },
        { word: 'hypothesis', phonetic: '/haÉªËˆpÉ’Î¸É™sÉªs/', meaning: 'å‡è®¾' },
        { word: 'inevitable', phonetic: '/ÉªnËˆevÉªtÉ™bl/', meaning: 'ä¸å¯é¿å…çš„' },
        { word: 'jurisdiction', phonetic: '/ËŒdÊ’ÊŠÉ™rÉªsËˆdÉªkÊƒn/', meaning: 'ç®¡è¾–æƒ' },
        { word: 'knowledgeable', phonetic: '/ËˆnÉ’lÉªdÊ’É™bl/', meaning: 'åšå­¦çš„' },
        { word: 'legitimate', phonetic: '/lÉªËˆdÊ’ÉªtÉªmÉ™t/', meaning: 'åˆæ³•çš„' },
        { word: 'magnificent', phonetic: '/mÃ¦É¡ËˆnÉªfÉªsnt/', meaning: 'å£®ä¸½çš„' },
        { word: 'negligible', phonetic: '/ËˆneÉ¡lÉªdÊ’É™bl/', meaning: 'å¯å¿½ç•¥çš„' },
        { word: 'phenomenon', phonetic: '/fÉªËˆnÉ’mÉªnÉ™n/', meaning: 'ç°è±¡' },
        { word: 'quintessential', phonetic: '/ËŒkwÉªntÉªËˆsenÊƒl/', meaning: 'å…¸å‹çš„' },
        { word: 'resilience', phonetic: '/rÉªËˆzÉªliÉ™ns/', meaning: 'éŸ§æ€§' },
        { word: 'sophisticated', phonetic: '/sÉ™ËˆfÉªstÉªkeÉªtÉªd/', meaning: 'å¤æ‚çš„' },
        { word: 'tremendous', phonetic: '/trÉ™ËˆmendÉ™s/', meaning: 'å·¨å¤§çš„' },
        { word: 'ubiquitous', phonetic: '/juËËˆbÉªkwÉªtÉ™s/', meaning: 'æ— å¤„ä¸åœ¨çš„' },
        { word: 'vulnerable', phonetic: '/ËˆvÊŒlnÉ™rÉ™bl/', meaning: 'è„†å¼±çš„' },
        { word: 'whimsical', phonetic: '/ËˆwÉªmzÉªkl/', meaning: 'å¼‚æƒ³å¤©å¼€çš„' },
        { word: 'xenophobia', phonetic: '/ËŒzenÉ™ËˆfoÊŠbiÉ™/', meaning: 'ä»‡å¤–å¿ƒç†' },
        { word: 'zealous', phonetic: '/ËˆzelÉ™s/', meaning: 'çƒ­å¿ƒçš„' },
        { word: 'ambiguous', phonetic: '/Ã¦mËˆbÉªÉ¡juÉ™s/', meaning: 'æ¨¡ç³Šçš„' }
      ]
    };

    let gameState = {
      isRunning: false,
      level: 'easy',
      score: 0,
      correct: 0,
      wrong: 0,
      streak: 0,
      maxStreak: 0,
      currentQuestion: null,
      timeLeft: 10,
      questionCount: 0,
      maxQuestions: 20,
      usedWords: []
    };

    let questionTimer = null;

    async function loadHighScores() {
      try {
        const response = await fetch(`/api/game-scores/${GAME_ID}`);
        return await response.json();
      } catch (error) {
        console.error('åŠ è½½åˆ†æ•°å¤±è´¥:', error);
        return { dailyBest: { score: 0 }, weeklyBest: { score: 0 }, allTimeBest: { score: 0 } };
      }
    }

    async function submitScore(finalScore) {
      try {
        const response = await fetch(`/api/game-scores/${GAME_ID}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ score: finalScore })
        });
        return await response.json();
      } catch (error) {
        console.error('æäº¤åˆ†æ•°å¤±è´¥:', error);
        return { isNewRecord: false };
      }
    }

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateQuestion() {
      const wordList = wordDatabase[gameState.level];
      const availableWords = wordList.filter(w => !gameState.usedWords.includes(w.word));
      
      if (availableWords.length < 4) {
        gameState.usedWords = [];
        return generateQuestion();
      }

      const correctWord = availableWords[Math.floor(Math.random() * availableWords.length)];
      gameState.usedWords.push(correctWord.word);
      
      const wrongWords = shuffleArray(wordList.filter(w => w.word !== correctWord.word)).slice(0, 3);
      
      const options = shuffleArray([correctWord.meaning, ...wrongWords.map(w => w.meaning)]);
      
      gameState.currentQuestion = {
        word: correctWord.word,
        phonetic: correctWord.phonetic,
        correctAnswer: correctWord.meaning,
        options: options
      };

      document.getElementById('progressInfo').textContent = 
        `é¢˜ç›® ${gameState.questionCount + 1}/${gameState.maxQuestions}`;
      document.getElementById('wordDisplay').textContent = correctWord.word;
      document.getElementById('wordDisplay').style.animation = 'none';
      setTimeout(() => {
        document.getElementById('wordDisplay').style.animation = 'fadeIn 0.3s ease';
      }, 10);
      document.getElementById('phonetic').textContent = correctWord.phonetic;

      const optionsContainer = document.getElementById('options');
      optionsContainer.innerHTML = options.map((opt, i) => 
        `<button class="option-btn" onclick="selectAnswer('${opt}')">${opt}</button>`
      ).join('');

      gameState.timeLeft = 10;
      document.getElementById('timerFill').style.width = '100%';
    }

    function selectAnswer(answer) {
      if (!gameState.isRunning) return;

      const buttons = document.querySelectorAll('.option-btn');
      buttons.forEach(btn => btn.disabled = true);

      const isCorrect = answer === gameState.currentQuestion.correctAnswer;

      buttons.forEach(btn => {
        if (btn.textContent === gameState.currentQuestion.correctAnswer) {
          btn.classList.add('correct');
        } else if (btn.textContent === answer && !isCorrect) {
          btn.classList.add('wrong');
        }
      });

      if (isCorrect) {
        const timeBonus = Math.floor(gameState.timeLeft);
        const streakBonus = Math.min(gameState.streak, 10);
        const points = 10 + timeBonus + streakBonus;
        
        gameState.score += points;
        gameState.correct++;
        gameState.streak++;
        if (gameState.streak > gameState.maxStreak) {
          gameState.maxStreak = gameState.streak;
        }
      } else {
        gameState.wrong++;
        gameState.streak = 0;
      }

      updateDisplay();
      gameState.questionCount++;

      setTimeout(() => {
        if (gameState.questionCount >= gameState.maxQuestions) {
          endGame();
        } else {
          generateQuestion();
        }
      }, 1000);
    }

    function updateDisplay() {
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('correct').textContent = gameState.correct;
      document.getElementById('wrong').textContent = gameState.wrong;
      document.getElementById('streak').textContent = gameState.streak;

      const streakDisplay = document.getElementById('streakDisplay');
      if (gameState.streak >= 5) {
        streakDisplay.classList.add('hot');
      } else {
        streakDisplay.classList.remove('hot');
      }
    }

    function updateQuestionTimer() {
      gameState.timeLeft -= 0.1;
      const percentage = (gameState.timeLeft / 10) * 100;
      document.getElementById('timerFill').style.width = Math.max(0, percentage) + '%';

      if (gameState.timeLeft <= 0) {
        selectAnswer('');
      }
    }

    function startGame() {
      const selectedLevel = document.querySelector('input[name="level"]:checked').value;
      
      gameState = {
        isRunning: true,
        level: selectedLevel,
        score: 0,
        correct: 0,
        wrong: 0,
        streak: 0,
        maxStreak: 0,
        currentQuestion: null,
        timeLeft: 10,
        questionCount: 0,
        maxQuestions: 20,
        usedWords: []
      };

      updateDisplay();
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('gameOverScreen').classList.add('hidden');

      questionTimer = setInterval(updateQuestionTimer, 100);
      generateQuestion();
    }

    async function endGame() {
      gameState.isRunning = false;
      if (questionTimer) clearInterval(questionTimer);

      const total = gameState.correct + gameState.wrong;
      const accuracy = total > 0 ? Math.round((gameState.correct / total) * 100) : 0;

      document.getElementById('finalScore').textContent = gameState.score;
      document.getElementById('finalCorrect').textContent = gameState.correct;
      document.getElementById('finalWrong').textContent = gameState.wrong;
      document.getElementById('accuracy').textContent = accuracy;
      document.getElementById('maxStreak').textContent = gameState.maxStreak;
      
      const result = await submitScore(gameState.score);
      
      document.getElementById('dailyBest').textContent = result.dailyBest || 0;
      document.getElementById('weeklyBest').textContent = result.weeklyBest || 0;
      document.getElementById('allTimeBest').textContent = result.allTimeBest || 0;

      document.getElementById('gameOverScreen').classList.remove('hidden');
    }

    function restartGame() {
      document.getElementById('gameOverScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
    }
  </script>
</body>
</html>
